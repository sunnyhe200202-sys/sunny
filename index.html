<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>重要事务记录 - 闹钟提醒</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/tdesign-vue-next/dist/tdesign.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/tdesign-vue-next/dist/tdesign.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #2563eb;
            --light-blue: #dbeafe;
            --dark-blue: #1e40af;
            --accent-purple: #9333ea;
            --light-purple: #f3e8ff;
            --white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
        }

        body {
            background: linear-gradient(135deg, var(--light-blue) 0%, var(--white) 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .primary-gradient {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
        }

        .accent-gradient {
            background: linear-gradient(135deg, var(--accent-purple) 0%, #7c3aed 100%);
        }

        .task-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .task-card.high-priority {
            border-left-color: #ef4444;
        }

        .task-card.medium-priority {
            border-left-color: #f59e0b;
        }

        .task-card.low-priority {
            border-left-color: #10b981;
        }

        .floating-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(147, 51, 234, 0.4);
            transition: all 0.3s ease;
        }

        .floating-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(147, 51, 234, 0.6);
        }

        .alarm-badge {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(147, 51, 234, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(147, 51, 234, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(147, 51, 234, 0);
            }
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .notification {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .time-display {
            font-family: 'Courier New', monospace;
            font-variant-numeric: tabular-nums;
        }

        .tab-active {
            border-bottom: 3px solid var(--accent-purple);
            color: var(--accent-purple);
        }

        .stats-card {
            background: linear-gradient(135deg, var(--white) 0%, var(--gray-50) 100%);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="glass-effect sticky top-0 z-40 border-b border-gray-200">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="primary-gradient text-white p-2 rounded-lg">
                            <i class="fas fa-bell text-xl"></i>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-800">重要事务管理</h1>
                            <p class="text-sm text-gray-600">高效管理您的关键任务</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <div class="text-sm text-gray-600">当前时间</div>
                            <div class="time-display text-lg font-bold text-gray-800" v-text="currentTime"></div>
                        </div>
                        <button @click="toggleView" class="p-2 rounded-lg hover:bg-gray-100 transition">
                            <i :class="viewMode === 'grid' ? 'fas fa-list' : 'fas fa-th'" class="text-gray-600"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="stats-card p-6 rounded-xl border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">总任务</p>
                            <p class="text-2xl font-bold text-gray-800">{{ tasks.length }}</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-lg">
                            <i class="fas fa-tasks text-blue-600"></i>
                        </div>
                    </div>
                </div>
                <div class="stats-card p-6 rounded-xl border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">待处理</p>
                            <p class="text-2xl font-bold text-orange-600">{{ pendingTasks }}</p>
                        </div>
                        <div class="bg-orange-100 p-3 rounded-lg">
                            <i class="fas fa-clock text-orange-600"></i>
                        </div>
                    </div>
                </div>
                <div class="stats-card p-6 rounded-xl border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">已完成</p>
                            <p class="text-2xl font-bold text-green-600">{{ completedTasks }}</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-lg">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>
                <div class="stats-card p-6 rounded-xl border border-gray-200">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-600">活跃闹钟</p>
                            <p class="text-2xl font-bold text-purple-600">{{ activeAlarms }}</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-lg alarm-badge">
                            <i class="fas fa-bell text-purple-600"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="flex space-x-6 mb-6 border-b border-gray-200">
                <button 
                    v-for="tab in tabs" 
                    :key="tab.key"
                    @click="activeTab = tab.key"
                    :class="['px-4 py-2 font-medium transition-colors', activeTab === tab.key ? 'tab-active' : 'text-gray-600 hover:text-gray-800']">
                    <i :class="tab.icon + ' mr-2'"></i>
                    {{ tab.name }}
                </button>
            </div>

            <!-- Tasks Grid/List -->
            <div :class="viewMode === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' : 'space-y-4'">
                <div 
                    v-for="task in filteredTasks" 
                    :key="task.id"
                    :class="['task-card glass-effect p-6 rounded-xl', task.priority + '-priority', viewMode === 'list' ? 'flex items-center justify-between' : '']">
                    
                    <div :class="viewMode === 'list' ? 'flex-1' : ''">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="text-lg font-semibold text-gray-800 mb-1">{{ task.title }}</h3>
                                <p class="text-sm text-gray-600 mb-2">{{ task.description }}</p>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <span :class="['px-2 py-1 rounded-full text-xs font-medium', getPriorityClass(task.priority)]">
                                    {{ getPriorityText(task.priority) }}
                                </span>
                                <button 
                                    v-if="task.alarmEnabled"
                                    class="text-purple-600 hover:text-purple-800">
                                    <i class="fas fa-bell"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <div class="flex items-center space-x-4">
                                <span v-if="task.alarmTime">
                                    <i class="fas fa-clock mr-1"></i>
                                    {{ task.alarmTime }}
                                </span>
                                <span>
                                    <i class="fas fa-calendar mr-1"></i>
                                    {{ formatDate(task.createdAt) }}
                                </span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button 
                                    @click="toggleTaskComplete(task.id)"
                                    :class="['p-2 rounded-lg transition', task.completed ? 'bg-green-100 text-green-600' : 'hover:bg-gray-100']">
                                    <i :class="task.completed ? 'fas fa-check-circle' : 'far fa-circle'"></i>
                                </button>
                                <button @click="editTask(task)" class="p-2 hover:bg-gray-100 rounded-lg transition">
                                    <i class="fas fa-edit text-gray-600"></i>
                                </button>
                                <button @click="deleteTask(task.id)" class="p-2 hover:bg-red-100 rounded-lg transition">
                                    <i class="fas fa-trash text-red-600"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div v-if="filteredTasks.length === 0" class="text-center py-12">
                <div class="glass-effect inline-flex items-center justify-center w-20 h-20 rounded-full mb-4">
                    <i class="fas fa-clipboard-list text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">暂无任务</h3>
                <p class="text-gray-600 mb-6">点击右下角按钮创建您的第一个重要任务</p>
            </div>
        </main>

        <!-- Floating Action Button -->
        <button 
            @click="showCreateModal = true"
            class="floating-btn accent-gradient text-white">
            <i class="fas fa-plus text-xl"></i>
        </button>

        <!-- Create/Edit Task Modal -->
        <div v-if="showCreateModal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4">
            <div class="glass-effect rounded-2xl max-w-md w-full p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-800">
                        {{ editingTask ? '编辑任务' : '创建新任务' }}
                    </h2>
                    <button @click="closeModal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <form @submit.prevent="saveTask">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">任务标题</label>
                            <input 
                                v-model="taskForm.title"
                                type="text"
                                required
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                placeholder="输入任务标题">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">任务描述</label>
                            <textarea 
                                v-model="taskForm.description"
                                rows="3"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                placeholder="输入任务描述"></textarea>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">优先级</label>
                                <select 
                                    v-model="taskForm.priority"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="high">高</option>
                                    <option value="medium">中</option>
                                    <option value="low">低</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">提醒时间</label>
                                <input 
                                    v-model="taskForm.alarmTime"
                                    type="time"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                        </div>

                        <div class="flex items-center">
                            <input 
                                v-model="taskForm.alarmEnabled"
                                type="checkbox"
                                class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                            <label class="ml-2 text-sm text-gray-700">启用闹钟提醒</label>
                        </div>
                    </div>

                    <div class="flex space-x-3 mt-6">
                        <button 
                            type="button"
                            @click="closeModal"
                            class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                            取消
                        </button>
                        <button 
                            type="submit"
                            class="flex-1 px-4 py-2 primary-gradient text-white rounded-lg hover:opacity-90 transition">
                            {{ editingTask ? '保存修改' : '创建任务' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Notifications -->
        <div class="fixed top-20 right-4 z-50 space-y-2">
            <div 
                v-for="notification in notifications" 
                :key="notification.id"
                :class="['notification glass-effect p-4 rounded-lg max-w-sm', notification.type === 'success' ? 'border-l-4 border-green-500' : 'border-l-4 border-blue-500']">
                <div class="flex items-center">
                    <i :class="['mr-3', notification.type === 'success' ? 'fas fa-check-circle text-green-600' : 'fas fa-info-circle text-blue-600']"></i>
                    <div>
                        <p class="font-medium text-gray-800">{{ notification.title }}</p>
                        <p class="text-sm text-gray-600">{{ notification.message }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentTime: '',
                    viewMode: 'grid',
                    activeTab: 'all',
                    showCreateModal: false,
                    editingTask: null,
                    tasks: [],
                    notifications: [],
                    tabs: [
                        { key: 'all', name: '全部任务', icon: 'fas fa-list' },
                        { key: 'pending', name: '待处理', icon: 'fas fa-clock' },
                        { key: 'completed', name: '已完成', icon: 'fas fa-check-circle' },
                        { key: 'alarms', name: '闹钟', icon: 'fas fa-bell' }
                    ],
                    taskForm: {
                        title: '',
                        description: '',
                        priority: 'medium',
                        alarmTime: '',
                        alarmEnabled: false
                    }
                };
            },
            computed: {
                filteredTasks() {
                    switch (this.activeTab) {
                        case 'pending':
                            return this.tasks.filter(task => !task.completed);
                        case 'completed':
                            return this.tasks.filter(task => task.completed);
                        case 'alarms':
                            return this.tasks.filter(task => task.alarmEnabled);
                        default:
                            return this.tasks;
                    }
                },
                pendingTasks() {
                    return this.tasks.filter(task => !task.completed).length;
                },
                completedTasks() {
                    return this.tasks.filter(task => task.completed).length;
                },
                activeAlarms() {
                    return this.tasks.filter(task => task.alarmEnabled).length;
                }
            },
            methods: {
                updateTime() {
                    const now = new Date();
                    this.currentTime = now.toLocaleTimeString('zh-CN', { 
                        hour12: false,
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                    
                    // Check alarms
                    this.checkAlarms(now);
                },
                checkAlarms(now) {
                    const currentTimeStr = now.toTimeString().substr(0, 5);
                    
                    this.tasks.forEach(task => {
                        if (task.alarmEnabled && task.alarmTime === currentTimeStr && !task.completed && !task.notifiedToday) {
                            this.showNotification('闹钟提醒', `任务"${task.title}"的提醒时间到了！`, 'info');
                            task.notifiedToday = true;
                            
                            // Play notification sound (using Web Audio API for a simple beep)
                            this.playNotificationSound();
                        }
                    });
                },
                playNotificationSound() {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                },
                toggleView() {
                    this.viewMode = this.viewMode === 'grid' ? 'list' : 'grid';
                },
                getPriorityClass(priority) {
                    const classes = {
                        high: 'bg-red-100 text-red-700',
                        medium: 'bg-yellow-100 text-yellow-700',
                        low: 'bg-green-100 text-green-700'
                    };
                    return classes[priority] || classes.medium;
                },
                getPriorityText(priority) {
                    const texts = {
                        high: '高优先级',
                        medium: '中优先级',
                        low: '低优先级'
                    };
                    return texts[priority] || texts.medium;
                },
                formatDate(dateStr) {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('zh-CN');
                },
                toggleTaskComplete(taskId) {
                    const task = this.tasks.find(t => t.id === taskId);
                    if (task) {
                        task.completed = !task.completed;
                        this.saveTasks();
                        this.showNotification(
                            task.completed ? '任务完成' : '任务恢复',
                            task.completed ? `任务"${task.title}"已标记为完成` : `任务"${task.title}"已恢复为待处理`,
                            'success'
                        );
                    }
                },
                editTask(task) {
                    this.editingTask = task;
                    this.taskForm = {
                        title: task.title,
                        description: task.description,
                        priority: task.priority,
                        alarmTime: task.alarmTime,
                        alarmEnabled: task.alarmEnabled
                    };
                    this.showCreateModal = true;
                },
                deleteTask(taskId) {
                    if (confirm('确定要删除这个任务吗？')) {
                        const taskIndex = this.tasks.findIndex(t => t.id === taskId);
                        if (taskIndex > -1) {
                            const taskTitle = this.tasks[taskIndex].title;
                            this.tasks.splice(taskIndex, 1);
                            this.saveTasks();
                            this.showNotification('任务已删除', `任务"${taskTitle}"已被删除`, 'success');
                        }
                    }
                },
                saveTask() {
                    if (this.editingTask) {
                        // Update existing task
                        Object.assign(this.editingTask, this.taskForm);
                        this.showNotification('任务已更新', `任务"${this.taskForm.title}"已更新`, 'success');
                    } else {
                        // Create new task
                        const newTask = {
                            id: Date.now(),
                            ...this.taskForm,
                            completed: false,
                            createdAt: new Date().toISOString(),
                            notifiedToday: false
                        };
                        this.tasks.unshift(newTask);
                        this.showNotification('任务已创建', `任务"${this.taskForm.title}"已创建`, 'success');
                    }
                    
                    this.saveTasks();
                    this.closeModal();
                },
                closeModal() {
                    this.showCreateModal = false;
                    this.editingTask = null;
                    this.taskForm = {
                        title: '',
                        description: '',
                        priority: 'medium',
                        alarmTime: '',
                        alarmEnabled: false
                    };
                },
                showNotification(title, message, type = 'success') {
                    const notification = {
                        id: Date.now(),
                        title,
                        message,
                        type
                    };
                    
                    this.notifications.push(notification);
                    
                    // Auto remove after 3 seconds
                    setTimeout(() => {
                        const index = this.notifications.findIndex(n => n.id === notification.id);
                        if (index > -1) {
                            this.notifications.splice(index, 1);
                        }
                    }, 3000);
                },
                saveTasks() {
                    localStorage.setItem('tasks', JSON.stringify(this.tasks));
                },
                loadTasks() {
                    const saved = localStorage.getItem('tasks');
                    if (saved) {
                        this.tasks = JSON.parse(saved);
                    } else {
                        // Load sample tasks for demonstration
                        this.tasks = [
                            {
                                id: 1,
                                title: '完成项目报告',
                                description: '准备季度项目总结报告，包含数据分析和未来规划',
                                priority: 'high',
                                alarmTime: '09:00',
                                alarmEnabled: true,
                                completed: false,
                                createdAt: new Date().toISOString(),
                                notifiedToday: false
                            },
                            {
                                id: 2,
                                title: '团队会议',
                                description: '与开发团队讨论新功能实现方案',
                                priority: 'medium',
                                alarmTime: '14:30',
                                alarmEnabled: true,
                                completed: false,
                                createdAt: new Date(Date.now() - 86400000).toISOString(),
                                notifiedToday: false
                            },
                            {
                                id: 3,
                                title: '代码审查',
                                description: '审查前端代码，确保符合编码规范',
                                priority: 'low',
                                alarmTime: '',
                                alarmEnabled: false,
                                completed: true,
                                createdAt: new Date(Date.now() - 172800000).toISOString(),
                                notifiedToday: false
                            }
                        ];
                    }
                },
                resetDailyNotifications() {
                    const now = new Date();
                    const today = now.toDateString();
                    const lastReset = localStorage.getItem('lastNotificationReset');
                    
                    if (lastReset !== today) {
                        this.tasks.forEach(task => {
                            task.notifiedToday = false;
                        });
                        localStorage.setItem('lastNotificationReset', today);
                        this.saveTasks();
                    }
                }
            },
            mounted() {
                this.loadTasks();
                this.updateTime();
                setInterval(this.updateTime, 1000);
                this.resetDailyNotifications();
                
                // Request notification permission
                if ('Notification' in window && Notification.permission === 'default') {
                    Notification.requestPermission();
                }
            }
        }).mount('#app');
    </script>
</body>
</html>